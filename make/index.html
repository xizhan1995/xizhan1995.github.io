<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.32">
    <title>2019年8月9日 | 个人笔记</title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.11a37516.js"><link rel="modulepreload" href="/assets/index.html.a728cbae.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/index.html.5b99df05.js">
    <link rel="stylesheet" href="/assets/style.b5235dab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">个人笔记</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/xizhan1995/xizhan1995.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/xizhan1995/xizhan1995.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p class="sidebar-item sidebar-heading">2019年8月9日 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/make/#_2019年8月9日" class="router-link-active router-link-exact-active sidebar-item" aria-label="2019年8月9日"><!--[--><!--]--> 2019年8月9日 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/make/#笔记链接" class="router-link-active router-link-exact-active sidebar-item" aria-label="笔记链接"><!--[--><!--]--> 笔记链接 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/make/#简要介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="简要介绍"><!--[--><!--]--> 简要介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/make/#hello-world-目标-makefile文件路径" class="router-link-active router-link-exact-active sidebar-item" aria-label="hello world &amp; 目标 &amp; makefile文件路径"><!--[--><!--]--> hello world &amp; 目标 &amp; makefile文件路径 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/make/#hello-world-2-make-更新目标的逻辑" class="router-link-active router-link-exact-active sidebar-item" aria-label="hello world 2 &amp; make 更新目标的逻辑"><!--[--><!--]--> hello world 2 &amp; make 更新目标的逻辑 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/make/#makefile-语法" class="router-link-active router-link-exact-active sidebar-item" aria-label="makefile 语法"><!--[--><!--]--> makefile 语法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/make/#总结-make-启动过程-简化" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结：make 启动过程（简化）"><!--[--><!--]--> 总结：make 启动过程（简化） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/make/#术语" class="router-link-active router-link-exact-active sidebar-item" aria-label="术语"><!--[--><!--]--> 术语 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/make/#最佳实践" class="router-link-active router-link-exact-active sidebar-item" aria-label="最佳实践"><!--[--><!--]--> 最佳实践 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/make/#list-列出所有target" class="router-link-active router-link-exact-active sidebar-item" aria-label="list：列出所有target"><!--[--><!--]--> list：列出所有target <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="_2019年8月9日" tabindex="-1"><a class="header-anchor" href="#_2019年8月9日" aria-hidden="true">#</a> 2019年8月9日</h1><h2 id="笔记链接" tabindex="-1"><a class="header-anchor" href="#笔记链接" aria-hidden="true">#</a> 笔记链接</h2><ul><li><a href="/make/note-make-%E6%89%8B%E5%86%8C.html" class="">note-make-手册</a></li></ul><hr><p><a href="https://www.gnu.org/software/make/manual/make.html" target="_blank" rel="noopener noreferrer">GNU make<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a><a href="http://www.ruanyifeng.com/blog/2015/02/make.html" target="_blank" rel="noopener noreferrer">Make 命令教程 - 阮一峰的网络日志<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><ul><li><p>implicit target</p></li><li><p>phony target <a href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets" target="_blank" rel="noopener noreferrer">4.6 Phony Targets<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></li><li><p>empty target 4.8 Empty Target Files to Record Events https://www.gnu.org/software/make/manual/make.html#Empty-Targets</p></li><li><p>stardard target https://www.gnu.org/software/make/manual/make.html#Standard-Targets</p></li><li><p>标准变量 <a href="https://www.gnu.org/software/make/manual/make.html#Implicit-Variables" target="_blank" rel="noopener noreferrer">10.3 Variables Used by Implicit Rules<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p></li><li><p>续行</p></li><li><p>pattern rules (see Defining and Redefining Pattern Rules).</p></li><li><p>explicit rule</p></li><li><p>implicit rule</p></li><li><p>double-colon rule</p></li><li><p>static-pattern rule</p></li></ul><p>make工具的各种语法特性显然是从实践中总结出来的。</p><ul><li>普通目标：把源文件编译成程序</li><li>伪目标：执行指定动作，比如 clean</li><li>% 通配符、自动变量：大批重复规则：%.c -&gt; %.o 的编译规则是完全类似的。Q. % 叫什么？包含 % 的规则叫什么？</li><li>内置规则：C 语言编程规则 %.c -&gt; %.o 太常用了，内置</li><li>变量：重复、公用的文本</li><li>利用 gcc 自动计算头文件依赖</li><li>……</li></ul><p>读一读 https://www.cnblogs.com/lotgu/p/5936465.html</p><h2 id="简要介绍" tabindex="-1"><a class="header-anchor" href="#简要介绍" aria-hidden="true">#</a> 简要介绍</h2><p>Make是最常用的构建工具，诞生于1977年，主要用于C语言的项目。 也可以用于其它地方。</p><h2 id="hello-world-目标-makefile文件路径" tabindex="-1"><a class="header-anchor" href="#hello-world-目标-makefile文件路径" aria-hidden="true">#</a> hello world &amp; 目标 &amp; makefile文件路径</h2><p>使用 make 工具分为两步：</p><ol><li>编写 makefile</li><li>调用 make 命令</li></ol><p>在新目录下创建名为 Makefile 的文件，写入如下内容</p><div class="language-Makefile ext-Makefile line-numbers-mode"><pre class="language-Makefile"><code># File: Makefile
hello:
    echo hello, world
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注：echo hello, world 的前面必须是一个 tab，不能是空格。</p><p>执行命令 <code>make hello</code>。输出结果如下</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">make</span> hello
<span class="token builtin class-name">echo</span> hello, world
hello, world
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>make 命令默认使用 <code>Makefile</code> 作为数据库文件名，可以用 -f 指定自定义的 makefile 文件。</li><li>make 命令默认取 Makefile 的第一个 target（不算以句点开头的目标）作为目标。</li></ul><p>所以在这个例子中，如下命令是完全等价的</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 完整格式是指定 makefile 和目标</span>
<span class="token function">make</span> -f Makefile hello
<span class="token comment"># 而 Makefile 是默认文件名，可以省略</span>
<span class="token function">make</span> hello
<span class="token comment"># 另一方面，hello 是第一个 target，也可以省略</span>
<span class="token function">make</span> -f Makefile
<span class="token comment"># 当然可以同时省略</span>
<span class="token function">make</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="hello-world-2-make-更新目标的逻辑" tabindex="-1"><a class="header-anchor" href="#hello-world-2-make-更新目标的逻辑" aria-hidden="true">#</a> hello world 2 &amp; make 更新目标的逻辑</h2><p>实际上，make 最初是为了编译 C 语言项目而构建的。</p><p>下面的例子 用 make 编译 hello world 程序。</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// File: hello.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello, world\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-Makefile ext-Makefile line-numbers-mode"><pre class="language-Makefile"><code>hello: hello.c
    gcc hello.c -o hello
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注: gcc hello.c -o hello 的前面必须是一个 tab，不能是空格。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> hello
./hello
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>输出结果：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">make</span> hello
gcc hello.c -o hello

$ <span class="token function">ls</span>
hello  hello.c  Makefile

$ ./hello
hello, world
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Make 工具应对的预期工作流程/工作情景是这样的：</p><ul><li>每次编辑完 hello.c 之后，再次执行 make 即可重新编译文件</li><li>如果执行完 make 后，没有编辑 hello.c 直接执行 make，make 不会重复编译， 因为 make 会检查到上次编译后源文件并没有变化，所以 make 认为不需要重新编译。</li><li>make 命令通过比较源文件和目标文件的修改时间判断是否需要构建目标。 ps：时间戳可以伪造，不是百分之百可靠，但是效率快。</li><li>make 命令提供 -B 选项，无条件重新构建。 <blockquote><p>-B, --always-make Unconditionally make all targets.</p></blockquote></li></ul><h3 id="附-快速创建-hello-c-和-makefile" tabindex="-1"><a class="header-anchor" href="#附-快速创建-hello-c-和-makefile" aria-hidden="true">#</a> 附：快速创建 hello.c 和 Makefile</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&gt;</span> hello.c <span class="token operator">&lt;&lt;</span><span class="token string">EOF
#include&lt;stdio.h&gt;
int main(){
    printf(&quot;hello, world<span class="token entity" title="\n">\n</span>&quot;);
    return 0;
}
EOF</span>

<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> <span class="token function">sed</span> -E <span class="token string">&#39;s/^\s{4}/\t/&#39;</span> <span class="token operator">&gt;</span> Makefile</span>

hello: hello.c
    gcc hello.c -o hello
EOF</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="makefile-语法" tabindex="-1"><a class="header-anchor" href="#makefile-语法" aria-hidden="true">#</a> makefile 语法</h2><p>makefile 包含五种语法元素：</p><ul><li>explicit rules</li><li>implicit rules</li><li>variable definitions</li><li>directives</li><li>comments</li></ul><p>说规则和变量。</p><p>注：这里列出的只是常用的规则，每条规则介绍一部分，完整的规则列表和每条规则的完整逻辑，参考gnu手册笔记。</p><h3 id="规则-待续" tabindex="-1"><a class="header-anchor" href="#规则-待续" aria-hidden="true">#</a> 规则 待续...</h3><p>makefile 的基本组成元素是 rule（规则），rule 说明何时以及如何更新target。</p><p>规则的构成形式如下：</p><div class="language-make ext-make line-numbers-mode"><pre class="language-make"><code>target … : prerequisites …
        recipe
        …
        …
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>一个 rule 由 targte、prerequisite、recipe 三部分构成，target 是必须的，prerequisite 和 recipe 可以省略其一，但不许同时省略。</p><ul><li>target 分为两种，普通 target 对应生成的文件，phony target（伪目标）指定要执行的动作的名称。</li><li>规则 recipe每一行都得以 tab 字符开头。也可以改为其它字符开头，设置 .RECIPEPREFIX 变量即可。</li><li>回显 @ -s --silent .SILIENT</li><li>SHELL</li></ul><h3 id="折行-待续" tabindex="-1"><a class="header-anchor" href="#折行-待续" aria-hidden="true">#</a> 折行 待续...</h3><p>Makefile 中，换行符标志语句的结束。不限制行的长度。</p><p>行末的反斜杠可以续行。 续行本身和续行前后相邻的空白字符会被替换为单个空格。 多个连续的续行会替换为一个空格，而不是多个空格。</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code>foo<span class="token operator">=</span>a \
  \
  b
<span class="token comment"># 等价于</span>
foo<span class="token operator">=</span>a b
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>recipe 中的折行处理方式不同。</p><h3 id="包含其它文件" tabindex="-1"><a class="header-anchor" href="#包含其它文件" aria-hidden="true">#</a> 包含其它文件</h3><ul><li>include 指令用于包含其他makeilfe文件。</li><li>make 处理到include指令的时候会暂停处理当前makefile，转而读取include指定的makefile，待处理完成后，从include指令处继续处理当前 makefile。</li><li>包含文件缺失且无法构建时，make 命令会报错退出；用 -include 代替 include，make 就会忽略这错误。</li></ul><h3 id="misc" tabindex="-1"><a class="header-anchor" href="#misc" aria-hidden="true">#</a> misc</h3><p>每个 target 只可以有一个 recipe，如果找到了多个，要么报错，要么后面的覆盖前面的。</p><h2 id="总结-make-启动过程-简化" tabindex="-1"><a class="header-anchor" href="#总结-make-启动过程-简化" aria-hidden="true">#</a> 总结：make 启动过程（简化）</h2><p>2021-12-22</p><ul><li><p>载入内置数据库</p></li><li><p>载入 MAKEFILES 变量指定的 makefile: 设置了环境变量才会载入，这里有找不到的文件不算错误</p></li><li><p>-f 和默认文件</p><ul><li>如果指定了 -f，就不考虑默认文件；如果未指定 -f 会尝试默认文件</li><li>默认文件可以类比 -include 指令</li></ul></li><li><p>remake，直到达到稳定</p></li></ul><p>深挖下去有更多细节。暂时了解到这些就够了。</p><h2 id="术语" tabindex="-1"><a class="header-anchor" href="#术语" aria-hidden="true">#</a> 术语</h2><ul><li><p><code>Double-colon rules</code> are explicit rules written with ‘::’ instead of ‘:’ after the target names.</p></li><li><p>goal：The <code>goals</code> are the targets that make should strive ultimately to update.</p></li><li><p>makefile：The information that tells make how to recompile a system comes from reading a data base called the <code>makefile</code> ch03</p></li><li><p>normal rules: ??</p></li><li><p>phony target:</p><ul><li>Targets that do not refer to files but are just actions are called <code>phony targets</code>.</li><li>A phony target is one that is not really the name of a file; rather it is just a name for a recipe to be executed when you make an explicit request.</li></ul></li><li><p>phsical line: We will refer to “physical lines” as a single line ending with a newline (regardless of whether it is escaped) and a “logical line” being a complete statement including all escaped newlines up to the first non-escaped newline.</p></li><li><p>implicit rule:</p></li><li><p>static pattern rules: Static pattern rules are rules which specify multiple targets and construct the prerequisite names for each target based on the target name.</p></li><li><p>variable/macro: A <code>variable</code> is a name defined in a makefile to represent a string of text, called the variable’s value. In some other versions of make, variables are called macros.</p></li></ul><h2 id="最佳实践" tabindex="-1"><a class="header-anchor" href="#最佳实践" aria-hidden="true">#</a> 最佳实践</h2><h3 id="实际中的-clean-规则示例" tabindex="-1"><a class="header-anchor" href="#实际中的-clean-规则示例" aria-hidden="true">#</a> 实际中的 clean 规则示例</h3><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token builtin">.PHONY</span><span class="token punctuation">:</span> clean
<span class="token symbol">clean</span><span class="token punctuation">:</span>
        -rm edit <span class="token variable">$</span><span class="token punctuation">(</span>objects<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>两个要点：</p><ol><li>.PHONY</li><li>-rm 而不是 rm。 ps：rm -f 可以代替 -rm。</li></ol><h2 id="list-列出所有target" tabindex="-1"><a class="header-anchor" href="#list-列出所有target" aria-hidden="true">#</a> list：列出所有target</h2><p>2021-12-22</p><p>https://www.itranslater.com/qa/details/2128087309269599232</p><p>GNU Make 没有内置此项功能。可以通过添加如下规则实现此目的</p><div class="language-makefile ext-makefile line-numbers-mode"><pre class="language-makefile"><code><span class="token builtin">.PHONY</span><span class="token punctuation">:</span> list
<span class="token symbol">list</span><span class="token punctuation">:</span>
<span class="token symbol">        @<span class="token variable">$</span>(MAKE) -pRrq -f <span class="token variable">$</span>(lastword <span class="token variable">$</span>(MAKEFILE_LIST))</span> <span class="token punctuation">:</span> 2&gt;/dev/null <span class="token operator">|</span> awk -v RS<span class="token operator">=</span> -F<span class="token punctuation">:</span> <span class="token string">&#39;/^# File/,/^# Finished Make data base/ {if ($1 !~ &quot;^[#.]&quot;) {print $1}}&#39;</span> <span class="token operator">|</span> sort <span class="token operator">|</span> egrep -v -e <span class="token string">&#39;^[^[:alnum:]]&#39;</span> -e <span class="token string">&#39;^$@$&#39;</span> <span class="token operator">|</span> xargs

<span class="token symbol">list</span><span class="token punctuation">:</span>
        <span class="token operator">@</span>LANG<span class="token operator">=</span>en_US.UTF-8 <span class="token variable">$</span><span class="token punctuation">(</span>MAKE<span class="token punctuation">)</span> -pRrq -f <span class="token variable">$</span><span class="token punctuation">(</span><span class="token keyword">lastword</span> <span class="token variable">$</span><span class="token punctuation">(</span>MAKEFILE_LIST<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> 2&gt;/dev/null <span class="token operator">|</span> awk -v RS<span class="token operator">=</span> -F<span class="token punctuation">:</span> <span class="token string">&#39;/^# File/,/^# Finished Make data base/ {if ($1 !~ &quot;^[#.]&quot;) {print $1}}&#39;</span> <span class="token operator">|</span> sort <span class="token operator">|</span> egrep -v -e <span class="token string">&#39;^[^[:alnum:]]&#39;</span> -e <span class="token string">&#39;^$@$&#39;</span> <span class="token operator">|</span> xargs
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这条规则实际调用 make -p 命令获取所有目标。</p><p>注：重要说明：粘贴此内容时，请确保最后一行缩进1个实际的tab char。 （空格不起作用）。</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/xizhan1995/xizhan1995.github.io/edit/main/make/Readme.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: chenxizhan1995@163.com">chenxizhan</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.11a37516.js" defer></script>
  </body>
</html>
